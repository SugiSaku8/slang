# S-Lang 仕様書

## 概要
S-Langは、C言語の低レベル制御とRustの安全性を組み合わせた、高性能で安全なプログラミング言語です。独自の優先所有格システム、高度な型システム、包括的なツールサポートを特徴としています。

## 主要機能

### 1. 言語設計
- C言語のような低レベル制御とRustのような安全性
- 優先所有格システム
- 高度な型システム
- 安全なメモリ管理
- モダンな構文
- 数学的計算サポート
- モジュールシステム
- ファイル拡張子システム

### 2. 優先所有格システム
優先所有格システムは、変数、関数、メモリの実行時優先度を管理する独自の機能です。

#### 優先所有格の種類
1. **ログ優先所有格**
   - ログレベル: log, warn, alert, error, debug, info
   - 2次元構造
   - 各レベルのデフォルト優先度

2. **関数優先所有格**
   - 1次元構造
   - 動的優先度調整
   - 優先度の継承

3. **メモリ優先所有格**
   - 1-4次元構造
   - 動的優先度管理
   - 優先度競合の処理

### 3. 型システム

#### 基本型
- `int`: 64ビット整数
- `float`: 64ビット浮動小数点数
- `bool`: 真偽値
- `char`: UTF-8文字
- `string`: UTF-8文字列
- `void`: 空型

#### 複合型
- 配列: `[T; N]`
- タプル: `(T1, T2, ...)`
- 構造体: `struct`
- 列挙型: `enum`

#### 数学的型
- ベクトル: `Vector<N, T>`
- 行列: `Matrix<M, N, T>`
- テンソル: `Tensor<Dims, T>`
- 四元数: `Quaternion<T>`
- 複素数: `Complex<T>`

### 4. メモリ管理

#### 所有権システム
- ムーブセマンティクス
- 借用
- 参照カウント
- 優先度ベースのメモリ管理

#### メモリ安全性
- 所有権チェック
- 借用チェッカー
- 安全なポインタ操作
- 自動メモリクリーンアップ

### 5. ランタイム機能

#### メモリ管理
- ヒープ割り当て
- スタック管理
- 優先度ベースのメモリ追跡
- 自動クリーンアップ

#### 標準ライブラリ
- 基本I/O操作
- 文字列操作
- 数学関数
- 優先所有格ユーティリティ

### 6. 最適化パス

#### 定数畳み込み
- 算術演算
- 論理演算
- 文字列操作
- 型固有の最適化

#### 不要コード削除
- 未使用変数の削除
- 到達不能コードの削除
- 優先度ベースのコード削除

#### 優先所有格の最適化
- 優先度継承の最適化
- 優先度チェーンの最適化
- メモリアクセスの最適化

### 7. デバッグサポート

#### ブレークポイント
- 行ベースのブレークポイント
- 条件付きブレークポイント
- 優先度ベースのブレークポイント

#### 変数の監視
- 値の変更追跡
- 優先度の変更追跡
- メモリ状態の監視

#### 優先所有格のデバッグ
- 優先度チェーンの可視化
- 所有権の転送追跡
- メモリアクセスの監視

### 8. ファイル拡張子
- `.sl`: ソースファイル
- `.sls`: ヘッダファイル
- `.slu`: 特殊記法ファイル
- `.slm`: マクロファイル
- `.slb`: バイナリファイル

### 9. 構文機能

#### 基本構文
```slang
// 変数宣言
let x: int = 42;

// 関数定義
fn add(a: int, b: int) -> int {
    return a + b;
}

// 優先所有格
Var:type:priority:[1, 2];

// パターンマッチング
match value {
    Some(x) => log!("Found: {}", x),
    None => log!("Not found"),
}
```

#### 優先所有格の構文
```slang
// ログ優先度
log!("Message");  // 優先度: [Log, 0]
info!("Message"); // 優先度: [Log, 1]
debug!("Message"); // 優先度: [Log, 2]

// 関数優先度
Function:type:priority:1;

// メモリ優先度
Var:type:priority:[1, 2];
```

### 10. 標準ライブラリ

#### コア関数
- `print`: コンソール出力
- `len`: コレクションの長さ取得
- `clone`: ディープコピーの作成
- `drop`: 明示的なクリーンアップ

#### 数学関数
- ベクトル演算
- 行列演算
- テンソル演算
- 複素数演算

#### 優先度管理
- `set_priority`: 変数の優先度設定
- `get_priority`: 変数の優先度取得
- `transfer_ownership`: 優先度付き所有権の転送

### 11. コンパイラ機能

#### 最適化
- 定数畳み込み
- 不要コード削除
- 優先度ベースの最適化
- メモリアクセスの最適化

#### コード生成
- LLVMバックエンド
- 優先度を考慮したコード生成
- メモリ安全性チェック
- ランタイムチェック

### 12. 開発ツール

#### デバッガ
- ブレークポイントサポート
- 変数の監視
- 優先所有格のデバッグ
- メモリ状態の検査

#### フォーマッタ
- コードスタイルの強制
- 優先所有格のフォーマット
- ドキュメント生成

#### シンタックスハイライト
- 構文ハイライト
- 優先所有格のハイライト
- エラーのハイライト

## 実装詳細

### コンパイラアーキテクチャ
1. 字句解析器
2. 構文解析器
3. AST生成
4. IR生成
5. 最適化パス
6. コード生成

### ランタイムアーキテクチャ
1. メモリマネージャ
2. 優先所有格マネージャ
3. 標準ライブラリ
4. デバッガインターフェース

### デバッガアーキテクチャ
1. ブレークポイントマネージャ
2. 変数監視器
3. 優先所有格デバッガ
4. メモリインスペクタ

## ベストプラクティス

### 優先所有格
1. 適切な優先度レベルの使用
2. 優先度の競合を避ける
3. 優先度要件の文書化
4. 優先度の継承の慎重な使用

### メモリ管理
1. 所有権ルールの遵守
2. 適切な借用の使用
3. リソースのクリーンアップ
4. メモリ使用量の監視

### コード構成
1. 適切なファイル拡張子の使用
2. モジュール構造の遵守
3. 優先度要件の文書化
4. 標準ライブラリ関数の使用

## 将来の拡張

### 計画中の機能
1. 並列実行サポート
2. 高度な優先度継承
3. 拡張された数学的型
4. 強化されたデバッグツール

### 研究分野
1. 優先所有格の最適化
2. メモリ安全性の検証
3. パフォーマンス最適化
4. ツールの改善 